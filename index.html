<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dzair Sourcing Cars - Calculateur d'Importation</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM (UMD, REQUIRED for createRoot) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel (MUST be after React UMD) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at top, #020617 0, #020617 35%, #0b1120 55%, #111827 100%);
      color: #e5e7eb;
      min-height: 100vh;
    }
    .card {
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(148,163,184,0.35);
      backdrop-filter: blur(10px);
      border-radius: 14px;
      padding: 1.2rem 1.4rem;
    }
    .input-field {
      width: 100%;
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.85);
      color: #e5e7eb;
    }
    .result-card {
      background: linear-gradient(135deg,#22c55e,#15803d);
      padding: 18px;
      border-radius: 14px;
      color: white;
      box-shadow: 0 18px 40px rgba(34,197,94,0.45);
    }
  </style>
</head>

<body>
  <div id="app"></div>

  <!-- FULL REACT APP -->
  <script type="text/babel">

    const { useState, useEffect, useCallback } = React;

    /* -------------------- TRANSLATIONS -------------------- */

    const translations = {
      fr: {
        title: "Dzair Sourcing Cars",
        subtitle: "Calculateur d'importation de véhicules en Algérie",
        currency: "Devise",
        usd: "Dollar US",
        eur: "Euro",
        vehicleInfo: "Informations du véhicule",
        carPrice: "Prix du véhicule (FOB)",
        vehicleAge: "État du véhicule",
        brandNew: "Neuf (0 km)",
        usedUnder3: "Occasion (moins de 3 ans)",
        engineType: "Type de moteur",
        electric: "Électrique",
        gasolineSmall: "Essence ≤1800 cm³",
        gasolineLarge: "Essence >1800 cm³",
        hybridSmall: "Hybride ≤1800 cm³",
        hybridLarge: "Hybride >1800 cm³",
        foreignCosts: "Coûts en devise étrangère",
        freightInsurance: "Fret + Assurance",
        localCosts: "Coûts locaux (DZD)",
        inspection: "Frais d'inspection",
        documentation: "Frais de documentation",
        portBroker: "Transitaire + Port",
        exchangeRates: "Taux de change",
        officialRate: "Taux officiel",
        blackMarketRate: "Taux parallèle",
        fobPrice: "Prix d'achat (FOB)",
        atBlackRate: "au taux parallèle",
        freightCost: "Fret + Assurance",
        otherFees: "Autres frais",
        customsCIF: "Valeur CIF douanière",
        atOfficialRate: "au taux officiel",
        forTaxCalc: "(utilisé pour le calcul douanier)",
        customsRights: "Droits & Taxes",
        onCIF: "sur CIF",
        baseRate: "Taux de base",
        discount: "Réduction",
        finalRate: "Taux final",
        dd: "Droits de Douane (DD)",
        tcs: "Taxe de solidarité (TCS)",
        tva: "TVA",
        newCarTax: "Vignette véhicule neuf",
        notApplicable: "Non applicable",
        totalCost: "Coût total",
        legalRef: "Références légales",
        decree: "Décret 23-74 (20 février 2023)",
        article: "Article 110 – Loi de finances 2020",
        officialDouane: "https://www.douane.gov.dz",
        enterPrice: "Entrez un prix FOB pour voir le calcul",
        footerRights: "Tous droits réservés"
      }
    };

    /* -------------------- TAX RATES -------------------- */

    const usedRates = {
      electric: 11.42,
      gasolineSmall: 19.62,
      gasolineLarge: 121.06,
      hybridSmall: 19.62,
      hybridLarge: 121.06
    };

    const newCarDD = {
      electric: 30,
      gasolineSmall: 15,
      gasolineLarge: 30,
      hybridSmall: 15,
      hybridLarge: 30
    };

    const TCS = 3;
    const TVA = 19;
    const VIGNETTE = 150000;

    /* -------------------- MAIN REACT APP -------------------- */

    function App() {

      const t = translations["fr"]; // default French only
      const [currency, setCurrency] = useState("USD");
      const [vehicleAge, setVehicleAge] = useState("used");
      const [engine, setEngine] = useState("gasolineSmall");

      const [carPrice, setCarPrice] = useState("");
      const [freight, setFreight] = useState("");

      const [inspection, setInspection] = useState(15000);
      const [documentation, setDocumentation] = useState(10000);
      const [portBroker, setPortBroker] = useState(150000);

      const [blackUSD, setBlackUSD] = useState(232);
      const [blackEUR, setBlackEUR] = useState(250);
      const [officialUSD, setOfficialUSD] = useState(135.5);
      const [officialEUR, setOfficialEUR] = useState(145.3);

      const [result, setResult] = useState(null);

      function calc() {

        if (!carPrice) {
          setResult(null);
          return;
        }

        const price = parseFloat(carPrice);
        const fr = parseFloat(freight || 0);

        const black = currency === "USD" ? blackUSD : blackEUR;
        const official = currency === "USD" ? officialUSD : officialEUR;

        const fobDZD = price * black;
        const freightDZD = fr * black;

        const cif = (price + fr) * official;

        let dd = 0, tcs = 0, tva = 0, vignette = 0;

        if (vehicleAge === "new") {
          dd = cif * (newCarDD[engine] / 100);
          tcs = cif * (TCS / 100);
          tva = (cif + dd + tcs) * (TVA / 100);
          vignette = VIGNETTE;

        } else {
          const usedRate = usedRates[engine];
          dd = cif * (usedRate / 100);
        }

        const totalLocal = inspection + documentation + portBroker;

        const total = fobDZD + freightDZD + totalLocal + dd + tcs + tva + vignette;

        setResult({
          fobDZD,
          freightDZD,
          cif,
          dd,
          tcs,
          tva,
          totalLocal,
          vignette,
          total
        });
      }

      useEffect(calc, [
        carPrice, freight, currency, blackUSD, blackEUR, officialUSD, officialEUR,
        vehicleAge, engine, inspection, documentation, portBroker
      ]);

      return (
        <div className="p-4 max-w-6xl mx-auto">

          <h1 className="text-2xl font-bold text-white mb-2">
            {t.title}
          </h1>
          <p className="text-slate-300 mb-6">{t.subtitle}</p>


          {/* ----------- INPUTS ----------- */}
          <div className="grid md:grid-cols-2 gap-4">

            <div className="card">
              <label className="text-xs text-slate-300">{t.carPrice}</label>
              <input type="number"
                className="input-field mb-4"
                value={carPrice}
                onChange={e => setCarPrice(e.target.value)}
                placeholder="12000"
              />

              <label className="text-xs text-slate-300">{t.freightInsurance}</label>
              <input type="number"
                className="input-field mb-4"
                value={freight}
                onChange={e => setFreight(e.target.value)}
                placeholder="1500"
              />

              <label className="text-xs text-slate-300">{t.vehicleAge}</label>
              <div className="flex gap-2 mt-1 mb-4">
                <button onClick={() => setVehicleAge("new")}
                  className={`px-3 py-2 rounded ${vehicleAge==="new" ? "bg-white text-black" : "bg-gray-800 text-white"}`}>
                  {t.brandNew}
                </button>
                <button onClick={() => setVehicleAge("used")}
                  className={`px-3 py-2 rounded ${vehicleAge==="used" ? "bg-white text-black" : "bg-gray-800 text-white"}`}>
                  {t.usedUnder3}
                </button>
              </div>

              <label className="text-xs text-slate-300">{t.engineType}</label>
              <select className="input-field mb-4"
                value={engine}
                onChange={e => setEngine(e.target.value)}>
                <option value="electric">{t.electric}</option>
                <option value="gasolineSmall">{t.gasolineSmall}</option>
                <option value="gasolineLarge">{t.gasolineLarge}</option>
                <option value="hybridSmall">{t.hybridSmall}</option>
                <option value="hybridLarge">{t.hybridLarge}</option>
              </select>

            </div>

            {/* Local + FX */}
            <div className="card">
              <label className="text-xs text-slate-300">{t.exchangeRates}</label>

              <div className="grid grid-cols-2 gap-3 mt-2">
                <div>
                  <p className="text-xs mb-1">{t.blackMarketRate}</p>
                  <input type="number" className="input-field mb-2"
                    value={blackUSD}
                    onChange={e => setBlackUSD(+e.target.value)}
                    placeholder="USD/DZD"
                  />
                  <input type="number" className="input-field"
                    value={blackEUR}
                    onChange={e => setBlackEUR(+e.target.value)}
                    placeholder="EUR/DZD"
                  />
                </div>

                <div>
                  <p className="text-xs mb-1">{t.officialRate}</p>
                  <input type="number" className="input-field mb-2"
                    value={officialUSD}
                    onChange={e => setOfficialUSD(+e.target.value)}
                    placeholder="USD/DZD"
                  />
                  <input type="number" className="input-field"
                    value={officialEUR}
                    onChange={e => setOfficialEUR(+e.target.value)}
                    placeholder="EUR/DZD"
                  />
                </div>
              </div>

              <p className="text-xs mt-4 mb-2">{t.localCosts}</p>
              <input type="number" className="input-field mb-2"
                value={inspection}
                onChange={e => setInspection(+e.target.value)} placeholder={t.inspection} />
              <input type="number" className="input-field mb-2"
                value={documentation}
                onChange={e => setDocumentation(+e.target.value)} placeholder={t.documentation} />
              <input type="number" className="input-field"
                value={portBroker}
                onChange={e => setPortBroker(+e.target.value)} placeholder={t.portBroker} />

            </div>

          </div>

          {/* ----------- RESULTS ----------- */}

          {!result && (
            <div className="card mt-6 text-center text-slate-400 text-sm">
              {t.enterPrice}
            </div>
          )}

          {result && (
            <div className="card mt-6">

              <div className="mb-4">
                <h2 className="text-lg font-semibold text-white mb-2">{t.results}</h2>
              </div>

              <div className="grid md:grid-cols-2 gap-3 text-sm">

                <div className="bg-gray-900 p-3 rounded border border-gray-700">
                  <p className="text-xs text-slate-400">{t.fobPrice}</p>
                  <p className="text-white font-semibold">{result.fobDZD.toLocaleString()} DZD</p>
                </div>

                <div className="bg-gray-900 p-3 rounded border border-gray-700">
                  <p className="text-xs text-slate-400">{t.freightCost}</p>
                  <p className="text-white font-semibold">{result.freightDZD.toLocaleString()} DZD</p>
                </div>

                <div className="bg-gray-900 p-3 rounded border border-gray-700">
                  <p className="text-xs text-slate-400">{t.customsCIF}</p>
                  <p className="text-white font-semibold">{result.cif.toLocaleString()} DZD</p>
                </div>

                <div className="bg-gray-900 p-3 rounded border border-gray-700">
                  <p className="text-xs text-slate-400">{t.dd}</p>
                  <p className="text-white font-semibold">{result.dd.toLocaleString()} DZD</p>
                </div>

                {vehicleAge === "new" && (
                  <>
                    <div className="bg-gray-900 p-3 rounded border border-gray-700">
                      <p className="text-xs text-slate-400">{t.tcs}</p>
                      <p className="text-white font-semibold">{result.tcs.toLocaleString()} DZD</p>
                    </div>

                    <div className="bg-gray-900 p-3 rounded border border-gray-700">
                      <p className="text-xs text-slate-400">{t.tva}</p>
                      <p className="text-white font-semibold">{result.tva.toLocaleString()} DZD</p>
                    </div>
                  </>
                )}

                <div className="bg-gray-900 p-3 rounded border border-gray-700">
                  <p className="text-xs text-slate-400">{t.otherFees}</p>
                  <p className="text-white font-semibold">{result.totalLocal.toLocaleString()} DZD</p>
                </div>

                {vehicleAge === "new" && (
                  <div className="bg-red-900 p-3 rounded border border-red-700">
                    <p className="text-xs text-red-300">{t.newCarTax}</p>
                    <p className="text-white font-semibold">{result.vignette.toLocaleString()} DZD</p>
                  </div>
                )}

              </div>

              <div className="result-card mt-5">
                <div className="text-lg font-semibold text-white">{t.totalCost}</div>
                <div className="text-2xl font-bold mt-1">{result.total.toLocaleString()} DZD</div>
              </div>

              <div className="mt-4 text-xs text-slate-400">
                <p className="font-semibold mb-1">{t.legalRef}</p>
                <p>• {t.decree}</p>
                <p>• {t.article}</p>
                <p>• <a href="https://www.douane.gov.dz" target="_blank" className="underline text-sky-300">www.douane.gov.dz</a></p>
              </div>

            </div>
          )}

          <footer className="text-center mt-10 text-xs text-slate-500">
            © 2025 – {t.footerRights}
          </footer>

        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("app")).render(<App />);

  </script>

</body>
</html>
